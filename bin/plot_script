#!/usr/local/bin/zsh -u

file="$1"
with="$2"
lattice="$3"
size=$4

param=$(head -n 1 $file)


case "$lattice" in
    square)
        plot="splot '$file' matrix w $with notitle"
        set_view="set contour base; unset surface; set view 0,0;"
        set_view=$set_view"set cntrparam levels incremental 0,0.1,1"
#        set_view=$set_view"set view map"
        ;;
    hex)
        set_view=$(cat << EOF
set grid
EOF
)
        plot="plot '$file' pt 7 ps $size notitle"
        ;;
    color)
        set_view="set pm3d; set pm3d map; set palette gray"
        plot="splot '$file' matrix w $with notitle"
        ;;
    *)
        echo "$lattice Didn't match anything" >2
        exit 1
esac


config=$(cat << EOF
$set_view
set size square
EOF
)

cat << EOF
$config
set title '$param'
$plot
EOF
